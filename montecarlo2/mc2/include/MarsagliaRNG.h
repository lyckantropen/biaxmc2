/* 
 * File:   MarsagliaRNG.h
 * Author: karol
 *
 * Created on 30 czerwiec 2011, 13:40
 */

#ifndef MARSAGLIARNG_H
#define	MARSAGLIARNG_H
#include <omp.h>
#include <iostream>


class MarsagliaRNG {
    unsigned long lsp[128][3];
    unsigned long seed;
    unsigned long mult;
    double Mother(unsigned long *pSeed,const unsigned long & pMult);
    short mother1[10];
    short mother2[10];
    short mStart;

public:
    MarsagliaRNG(){
        mStart = 1;
        mother1 = { 0,0,0,0,0, 0,0,0,0,0 };
        mother2 = { 0,0,0,0,0, 0,0,0,0,0 };
        lsp[0]={489UL, 2100239007743UL, 1050119503871UL};
        lsp[1]={1170UL, 5025111736319UL, 2512555868159UL};
        lsp[2]={1245UL, 5347234283519UL, 2673617141759UL};
        lsp[3]={1440UL, 6184752906239UL, 3092376453119UL};
        lsp[4]={1728UL, 7421703487487UL, 3710851743743UL};
        lsp[5]={2094UL, 8993661517823UL, 4496830758911UL};
        lsp[6]={2100UL, 9019431321599UL, 4509715660799UL};
        lsp[7]={2355UL, 10114647982079UL, 5057323991039UL};
        lsp[8]={2598UL, 11158325035007UL, 5579162517503UL};
        lsp[9]={2793UL, 11995843657727UL, 5997921828863UL};
        lsp[10]={2988UL, 12833362280447UL, 6416681140223UL};
        lsp[11]={3195UL, 13722420510719UL, 6861210255359UL};
        lsp[12]={3213UL, 13799729922047UL, 6899864961023UL};
        lsp[13]={3849UL, 16531329122303UL, 8265664561151UL};
        lsp[14]={3939UL, 16917876178943UL, 8458938089471UL};
        lsp[15]={4005UL, 17201344020479UL, 8600672010239UL};
        lsp[16]={4173UL, 17922898526207UL, 8961449263103UL};
        lsp[17]={4299UL, 18464064405503UL, 9232032202751UL};
        lsp[18]={4815UL, 20680267530239UL, 10340133765119UL};
        lsp[19]={4833UL, 20757576941567UL, 10378788470783UL};
        lsp[20]={5439UL, 23360327122943UL, 11680163561471UL};
        lsp[21]={5538UL, 23785528885247UL, 11892764442623UL};
        lsp[22]={5859UL, 25164213387263UL, 12582106693631UL};
        lsp[23]={6849UL, 29416231010303UL, 14708115505151UL};
        lsp[24]={7713UL, 33127082754047UL, 16563541377023UL};
        lsp[25]={9075UL, 38976828211199UL, 19488414105599UL};
        lsp[26]={9150UL, 39298950758399UL, 19649475379199UL};
        lsp[27]={9264UL, 39788577030143UL, 19894288515071UL};
        lsp[28]={10158UL, 43628277792767UL, 21814138896383UL};
        lsp[29]={10209UL, 43847321124863UL, 21923660562431UL};
        lsp[30]={10395UL, 44646185041919UL, 22323092520959UL};
        lsp[31]={10410UL, 44710609551359UL, 22355304775679UL};
        lsp[32]={10638UL, 45689862094847UL, 22844931047423UL};
        lsp[33]={10869UL, 46681999540223UL, 23340999770111UL};
        lsp[34]={10974UL, 47132971106303UL, 23566485553151UL};
        lsp[35]={11499UL, 49387828936703UL, 24693914468351UL};
        lsp[36]={12489UL, 53639846559743UL, 26819923279871UL};
        lsp[37]={12984UL, 55765855371263UL, 27882927685631UL};
        lsp[38]={13200UL, 56693568307199UL, 28346784153599UL};
        lsp[39]={14148UL, 60765197303807UL, 30382598651903UL};
        lsp[40]={14430UL, 61976378081279UL, 30988189040639UL};
        lsp[41]={14895UL, 63973537873919UL, 31986768936959UL};
        lsp[42]={15189UL, 65236258258943UL, 32618129129471UL};
        lsp[43]={15405UL, 66163971194879UL, 33081985597439UL};
        lsp[44]={15594UL, 66975720013823UL, 33487860006911UL};
        lsp[45]={15870UL, 68161130987519UL, 34080565493759UL};
        lsp[46]={16170UL, 69449621176319UL, 34724810588159UL};
        lsp[47]={16728UL, 71846212927487UL, 35923106463743UL};
        lsp[48]={17193UL, 73843372720127UL, 36921686360063UL};
        lsp[49]={17370UL, 74603581931519UL, 37301790965759UL};
        lsp[50]={18114UL, 77799037599743UL, 38899518799871UL};
        lsp[51]={18459UL, 79280801316863UL, 39640400658431UL};
        lsp[52]={18705UL, 80337363271679UL, 40168681635839UL};
        lsp[53]={19164UL, 82308753260543UL, 41154376630271UL};
        lsp[54]={19173UL, 82347407966207UL, 41173703983103UL};
        lsp[55]={19530UL, 83880711290879UL, 41940355645439UL};
        lsp[56]={19593UL, 84151294230527UL, 42075647115263UL};
        lsp[57]={19725UL, 84718229913599UL, 42359114956799UL};
        lsp[58]={19788UL, 84988812853247UL, 42494406426623UL};
        lsp[59]={19953UL, 85697482457087UL, 42848741228543UL};
        lsp[60]={21108UL, 90658169683967UL, 45329084841983UL};
        lsp[61]={21549UL, 92552250261503UL, 46276125130751UL};
        lsp[62]={22020UL, 94575179857919UL, 47287589928959UL};
        lsp[63]={22065UL, 94768453386239UL, 47384226693119UL};
        lsp[64]={22095UL, 94897302405119UL, 47448651202559UL};
        lsp[65]={22098UL, 94910187307007UL, 47455093653503UL};
        lsp[66]={22209UL, 95386928676863UL, 47693464338431UL};
        lsp[67]={22419UL, 96288871809023UL, 48144435904511UL};
        lsp[68]={22533UL, 96778498080767UL, 48389249040383UL};
        lsp[69]={22923UL, 98453535326207UL, 49226767663103UL};
        lsp[70]={23184UL, 99574521790463UL, 49787260895231UL};
        lsp[71]={23355UL, 100308961198079UL, 50154480599039UL};
        lsp[72]={24024UL, 103182294319103UL, 51591147159551UL};
        lsp[73]={24078UL, 103414222553087UL, 51707111276543UL};
        lsp[74]={24513UL, 105282533326847UL, 52641266663423UL};
        lsp[75]={24708UL, 106120051949567UL, 53060025974783UL};
        lsp[76]={25404UL, 109109349187583UL, 54554674593791UL};
        lsp[77]={25494UL, 109495896244223UL, 54747948122111UL};
        lsp[78]={26298UL, 112949049950207UL, 56474524975103UL};
        lsp[79]={26400UL, 113387136614399UL, 56693568307199UL};
        lsp[80]={26790UL, 115062173859839UL, 57531086929919UL};
        lsp[81]={28560UL, 122664265973759UL, 61332132986879UL};
        lsp[82]={28860UL, 123952756162559UL, 61976378081279UL};
        lsp[83]={29169UL, 125279901057023UL, 62639950528511UL};
        lsp[84]={29424UL, 126375117717503UL, 63187558858751UL};
        lsp[85]={29454UL, 126503966736383UL, 63251983368191UL};
        lsp[86]={29709UL, 127599183396863UL, 63799591698431UL};
        lsp[87]={30843UL, 132469676310527UL, 66234838155263UL};
        lsp[88]={30903UL, 132727374348287UL, 66363687174143UL};
        lsp[89]={31794UL, 136554190209023UL, 68277095104511UL};
        lsp[90]={31989UL, 137391708831743UL, 68695854415871UL};
        lsp[91]={32208UL, 138332306669567UL, 69166153334783UL};
        lsp[92]={32235UL, 138448270786559UL, 69224135393279UL};
        lsp[93]={32634UL, 140161962737663UL, 70080981368831UL};
        lsp[94]={32700UL, 140445430579199UL, 70222715289599UL};
        lsp[95]={33213UL, 142648748802047UL, 71324374401023UL};
        lsp[96]={33540UL, 144053203107839UL, 72026601553919UL};
        lsp[97]={34758UL, 149284473274367UL, 74642236637183UL};
        lsp[98]={35160UL, 151011050127359UL, 75505525063679UL};
        lsp[99]={35199UL, 151178553851903UL, 75589276925951UL};
        lsp[100]={35370UL, 151912993259519UL, 75956496629759UL};
        lsp[101]={36384UL, 156268090097663UL, 78134045048831UL};
        lsp[102]={36693UL, 157595234992127UL, 78797617496063UL};
        lsp[103]={36888UL, 158432753614847UL, 79216376807423UL};
        lsp[104]={37005UL, 158935264788479UL, 79467632394239UL};
        lsp[105]={37110UL, 159386236354559UL, 79693118177279UL};
        lsp[106]={37344UL, 160391258701823UL, 80195629350911UL};
        lsp[107]={38760UL, 166472932392959UL, 83236466196479UL};
        lsp[108]={38835UL, 166795054940159UL, 83397527470079UL};
        lsp[109]={39420UL, 169307610808319UL, 84653805404159UL};
        lsp[110]={39444UL, 169410690023423UL, 84705345011711UL};
        lsp[111]={40005UL, 171820166676479UL, 85910083338239UL};
        lsp[112]={40113UL, 172284023144447UL, 86142011572223UL};
        lsp[113]={40284UL, 173018462552063UL, 86509231276031UL};
        lsp[114]={40500UL, 173946175487999UL, 86973087743999UL};
        lsp[115]={40845UL, 175427939205119UL, 87713969602559UL};
        lsp[116]={41313UL, 177437983899647UL, 88718991949823UL};
        lsp[117]={41574UL, 178558970363903UL, 89279485181951UL};
        lsp[118]={41973UL, 180272662315007UL, 90136331157503UL};
        lsp[119]={42285UL, 181612692111359UL, 90806346055679UL};
        lsp[120]={42588UL, 182914067202047UL, 91457033601023UL};
        lsp[121]={42735UL, 183545427394559UL, 91772713697279UL};
        lsp[122]={43050UL, 184898342092799UL, 92449171046399UL};
        lsp[123]={43119UL, 185194694836223UL, 92597347418111UL};
        lsp[124]={43638UL, 187423782862847UL, 93711891431423UL};
        lsp[125]={45585UL, 195786084188159UL, 97893042094079UL};
        lsp[126]={45720UL, 196365904773119UL, 98182952386559UL};
        lsp[127]={45729UL, 196404559478783UL, 98202279739391UL};
        
        seed = lsp[omp_get_thread_num()][2];
        mult = lsp[omp_get_thread_num()][0];
        
        std::cout << omp_get_thread_num() << ": Seed: " << seed << ", Mult: " << mult << std::endl;
        std::cout << "sizeof(unsigned long): " << sizeof(unsigned long) << std::endl;
    }
    
    double operator()(){
        return Mother(&seed,mult);
    } 
    double Gen01(){
        return Mother(&seed,mult);
    }

};

#endif	/* MARSAGLIARNG_H */

